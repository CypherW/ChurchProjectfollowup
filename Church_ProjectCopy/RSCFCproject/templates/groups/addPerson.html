{% extends 'partials/groups_base.html' %}
{% block title %} Add Person {% endblock %}
{% load crispy_forms_tags %}
{% block content %}
{% load bootstrap5 %}
{% bootstrap_css %}
{% bootstrap_javascript %}
{% load static %}

<div id="modals-here"
    class="modal modal-blur fade"
    style="display: none"
    aria-hidden="false"
    tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div class="modal-content"></div>
    </div>
</div>

<div class="container">
    <div class="row mt-5">
        <div class="col-md-6 offset-md-3">
            <div class="border bg-white p-3">
                <h3 class="bg-info text-white p-3">Add Person</h3>
                
                <form method="POST">
                    {% csrf_token %}
                    {{ form|crispy }}
                
                    <div class="form-check form-check-inline" id="guardian_select">
                        <input class="form-check-input" type="radio" name="add_guardian" id="inlineRadio1" value="add_guardian"
                        hx-get="isguardian_entered"
                        hx-target="#guardian_select">
                        <label class="form-check-label" for="inlineRadio1">Select to add parent/guardian</label>    
                      </div>

                
                <div class="form-check mb-3" id="group_option_form">
                    <input class="form-check-input" type="checkbox" value="" id="flexCheckAddtoGroup"
                    hx-get="add_toGroupForm"
                    hx-target="#group_option_form">
                    <label class="form-check-label" for="flexCheckDefault">
                        Add to group?
                    </label>
                <div class="mt-2" id="buttons">
                <a class="btn btn-danger" href="{% url 'group_attendance' %}">Cancel</a>
                <input class="btn btn-secondary disabled" type="submit" value="Confirm">
                </div>
                </div>
                </form>
            </div>
            </div>
        </div>
    </div>
    <div id="popup-container"></div>

    

<script>
document.addEventListener('htmx:afterRequest', function(event) {
    if (event.detail.xhr.response.exists) {
        const personId = event.detail.xhr.response.person_id;
        if (confirm('This person already exists. Is it the same person?')) {
            window.location.href = `/person/${personId}/`;
        }
    }
});
</script>
</div>
{% endblock %}